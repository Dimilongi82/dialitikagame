<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Î ÏŒÏƒÎ¿ Î³ÏÎ®Î³Î¿ÏÎ± Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚; </title>
  <style>
    :root{
      --bg:#f3e7c9;
      --panel:#ffffff;
      --ink:#111;
      --muted:#555;
      --blue:#3b82f6;
      --green:#22c55e;
      --red:#ef4444;
      --gold:#f59e0b;
      --shadow: 0 10px 30px rgba(0,0,0,.12);
      --radius: 18px;
      --cell: 48px;
      --gap: 8px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{padding:18px 16px 0;max-width:1200px;margin:0 auto}
    .wrap{max-width:1200px;margin:0 auto;padding:12px 16px 30px;display:grid;grid-template-columns:1fr 360px;gap:16px;align-items:start}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}}
    .card{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
    h1{margin:8px 0 6px;font-size:clamp(22px,3vw,34px)}
    .subtitle{margin:0 0 12px;color:var(--muted);font-size:14px;line-height:1.35}

    .board{
      display:grid;
      grid-template-columns: repeat(10, var(--cell));
      gap: var(--gap);
      justify-content:center;
      padding: 10px 6px 14px;
      user-select:none;
    }
    @media (max-width: 460px){:root{--cell:42px;--gap:7px}}

    .cell{
      width:var(--cell);height:var(--cell);
      border-radius:999px;border:3px solid #222;
      display:flex;align-items:center;justify-content:center;
      font-weight:800;background:#fff;position:relative;
      font-size: 12px;
    }
    .cell.blue{border-color:var(--blue)}
    .cell.green{border-color:var(--green)}
    .cell.red{border-color:var(--red)}
    .cell.gold{border-color:var(--gold)}

    .pawn{
      position:absolute;width:16px;height:16px;border-radius:50%;
      background:#111;left:6px;bottom:6px;
      box-shadow:0 4px 10px rgba(0,0,0,.25);
      border:2px solid rgba(255,255,255,.7);
    }

    .side h2{margin:6px 0 10px;font-size:18px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:0;background:#111;color:#fff;padding:10px 12px;border-radius:999px;font-weight:800;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.alt{background:#fff;color:#111;border:1px solid #ddd}
    .pill{padding:8px 10px;border-radius:999px;background:#fafafa;border:1px solid #e8e8e8;font-weight:800}
    .log{margin-top:12px;padding:10px;border-radius:14px;background:#fafafa;border:1px solid #eee;height:240px;overflow:auto;font-size:13px}
    .log p{margin:0 0 8px;line-height:1.35}

    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:18px;z-index:50}
    .overlay.show{display:flex}
    .modal{width:min(760px,100%);background:#fff;border-radius:22px;box-shadow:var(--shadow);padding:16px}
    .modal h3{margin:6px 0 8px;font-size:20px}
    .modal .muted{color:var(--muted);font-size:13px;margin:0 0 10px;line-height:1.35}
    .choices{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
    @media (max-width: 520px){.choices{grid-template-columns:1fr}}
    .choice{
      border:3px solid #111;background:#fff;padding:16px;border-radius:18px;cursor:pointer;
      font-weight:1000;text-align:center;font-size:22px;letter-spacing:.2px;
      box-shadow:0 10px 20px rgba(0,0,0,.10);
      transition: transform .12s ease, background .12s ease;
    }
    .choice:hover{background:#f7f7f7;transform:translateY(-2px)}
    .choice:disabled{opacity:.7;transform:none;cursor:not-allowed}
    .rulebox{margin-top:12px;padding:12px;border-radius:16px;background:#fff7ed;border:1px solid #fed7aa;display:none}
    .rulebox.show{display:block}
    .timer{display:inline-flex;gap:8px;align-items:center;font-weight:900;padding:6px 10px;border-radius:999px;background:#ffe4e6;border:1px solid #fecdd3;margin-left:8px}
  </style>
</head>
<body>
<header>
  <h1>Î ÏŒÏƒÎ¿ Î³ÏÎ®Î³Î¿ÏÎ± Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± Ï†Ï„Î¬ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ Ï„Î­Î»Î¿Ï‚;</h1>
  <p class="subtitle">Î¡Î¯Î¾Îµ Ï„Î¿ Î¶Î¬ÏÎ¹, Ï€ÏÎ¿Ï‡ÏÏÎ± ÎºÎ±Î¹ Î´Î¹Î¬Î»ÎµÎ¾Îµ Ï„Î· ÏƒÏ‰ÏƒÏ„Î® Î³ÏÎ±Ï†Î®. Î— ÎµÎ¾Î®Î³Î·ÏƒÎ· Î¼Î­Î½ÎµÎ¹ 8â€™â€™ ÏƒÏ„Î·Î½ Î¿Î¸ÏŒÎ½Î·.</p>
</header>

<main class="wrap">
  <section class="card">
    <div class="board" id="board"></div>
    <p class="subtitle" style="margin:0;text-align:center">
      Î§ÏÏÎ¼Î±Ï„Î±: ğŸŸ¦ Î•Ï€Î¯Ï€ÎµÎ´Î¿ 1 Â· ğŸŸ© Î•Ï€Î¯Ï€ÎµÎ´Î¿ 2 Â· ğŸŸ¨ Boss Â· ğŸŸ¥ Î¤ÎµÎ»Î¹ÎºÏŒ (5â€™â€™ timer).
    </p>
  </section>

  <aside class="card side">
    <h2>Î Î¯Î½Î±ÎºÎ±Ï‚ Î•Î»Î­Î³Ï‡Î¿Ï…</h2>

    <div class="row" style="margin-bottom:10px;">
      <span class="pill">Î˜Î­ÏƒÎ·: <span id="posText">1</span></span>
      <span class="pill">Î–Î¬ÏÎ¹: <span id="diceText">â€”</span></span>
      <span class="pill">Î§ÏÏŒÎ½Î¿Ï‚: <span id="timeText">00:00</span></span>

    </div>

    <div class="row" style="margin-bottom:10px;">
      <button class="btn" id="rollBtn">Î¡Î¯Î¾Îµ Ï„Î¿ Î¶Î¬ÏÎ¹ ğŸ²</button>
      <button class="btn alt" id="resetBtn">Î•Ï€Î±Î½ÎµÎºÎºÎ¯Î½Î·ÏƒÎ·</button>
    </div>

    <div class="log" id="log" aria-live="polite"></div>

    <p class="subtitle" style="margin-top:10px;">
      ÎšÎ±Î½ÏŒÎ½ÎµÏ‚ ÎºÎ¯Î½Î·ÏƒÎ·Ï‚: ğŸŸ¦ ÏƒÏ‰ÏƒÏ„ÏŒ +1 Â· ğŸŸ© ÏƒÏ‰ÏƒÏ„ÏŒ +2 Â· ğŸŸ¨ ÏƒÏ‰ÏƒÏ„ÏŒ +3 Â· ğŸŸ¥ ÏƒÏ‰ÏƒÏ„ÏŒ +4, Î»Î¬Î¸Î¿Ï‚/timeout âˆ’3.
      ÎœÎµÏ„Î¬ Ï„Î¿ bonus/Ï€Î¿Î¹Î½Î® Î”Î•Î Î±Î½Î¿Î¯Î³ÎµÎ¹ Î´ÎµÏÏ„ÎµÏÎ· Î´Î¿ÎºÎ¹Î¼Î±ÏƒÎ¯Î±.
    </p>
  </aside>
</main>

<div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal">
    <h3 id="modalTitle">Î”Î¿ÎºÎ¹Î¼Î±ÏƒÎ¯Î±</h3>
    <p class="muted" id="modalDesc"></p>

    <div id="timerWrap" style="display:none;">
      <span class="timer">â±ï¸ <span id="timerNum">5</span>s</span>
      <span class="muted">Î”Î¹Î¬Î»ÎµÎ¾Îµ Î³ÏÎ®Î³Î¿ÏÎ±!</span>
    </div>

    <div class="card" style="padding:12px;border-radius:16px;box-shadow:none;border:1px solid #eee;">
      <div style="font-size:20px;font-weight:900;text-align:center;" id="questionText"></div>
    </div>

    <div class="choices" id="choices"></div>
    <div class="rulebox" id="rulebox"></div>

    <!-- ÎºÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ closeBtn Î³Î¹Î± ÏƒÏ…Î¼Î²Î±Ï„ÏŒÏ„Î·Ï„Î± Î¼Îµ ids, Î±Î»Î»Î¬ ÎºÏÏ…Ï†ÏŒ -->
    <button id="closeBtn" style="display:none;"></button>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const N = 100;

  const FEEDBACK_MS = 8000;
  const TRAP_SECONDS = 5;

const BLUE_POS  = [2,4,6,8,10,12,14,16,18,20,22,24];
const GREEN_POS = [27,30,33,36,39,42,45,48];
const GOLD_POS  = [52,56,60,64];
const RED_POS   = [69,74,79,84,89,94];


  const BLUE  = new Set(BLUE_POS);
  const GREEN = new Set(GREEN_POS);
  const GOLD  = new Set(GOLD_POS);
  const RED   = new Set(RED_POS);

  const ruleBase =
    'Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î· Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÎ® Î¤ÏÎ¹Î±Î½Ï„Î±Ï†Ï…Î»Î»Î¯Î´Î·: Î¤Î± Î´Î¹Î±Î»Ï…Ï„Î¹ÎºÎ¬ ÏƒÎ·Î¼ÎµÎ¹ÏÎ½Î¿Î½Ï„Î±Î¹ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ Î¹ Î® Ï… Î³Î¹Î± Î½Î± Î´ÎµÎ¯Î¾Î¿Ï…Î¼Îµ ÏŒÏ„Î¹ Ï€ÏÎ¿Ï†Î­ÏÎ¿Î½Ï„Î±Î¹ Ï‡Ï‰ÏÎ¹ÏƒÏ„Î¬ Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï†Ï‰Î½Î®ÎµÎ½ (Î±, Îµ, Î¿, Ï…).';
  const ruleTone =
    'Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î· Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÎ® Î¤ÏÎ¹Î±Î½Ï„Î±Ï†Ï…Î»Î»Î¯Î´Î·: Î”Îµ ÏƒÎ·Î¼ÎµÎ¹ÏÎ½Î¿Ï…Î¼Îµ Ï„Î± Î´Î¹Î±Î»Ï…Ï„Î¹ÎºÎ¬ ÏŒÏ„Î±Î½ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Ï†Ï‰Î½Î®ÎµÎ½ Ï€Î±Î¯ÏÎ½ÎµÎ¹ Ï„ÏŒÎ½Î¿ (Î¿ Ï„ÏŒÎ½Î¿Ï‚ â€œÎ´Î¹ÏÏ‡Î½ÎµÎ¹â€ Ï„Î¿ ÎºÎ±Ï€Î­Î»Î¿).';
  const ruleNoDiph =
    'Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î· Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÎ® Î¤ÏÎ¹Î±Î½Ï„Î±Ï†Ï…Î»Î»Î¯Î´Î·: Î”Îµ ÏƒÎ·Î¼ÎµÎ¹ÏÎ½Î¿Ï…Î¼Îµ Î´Î¹Î±Î»Ï…Ï„Î¹ÎºÎ¬ ÏŒÏ„Î±Î½ Î´ÎµÎ½ Î­Ï‡Î¿Ï…Î¼Îµ Î´Î¯ÏˆÎ·Ï†Î¿ Ï†Ï‰Î½Î®ÎµÎ½.';
  const ruleBoth =
    'Î£ÏÎ¼Ï†Ï‰Î½Î± Î¼Îµ Ï„Î· Î“ÏÎ±Î¼Î¼Î±Ï„Î¹ÎºÎ® Î¤ÏÎ¹Î±Î½Ï„Î±Ï†Ï…Î»Î»Î¯Î´Î·: ÎŒÏ„Î±Î½ Ï‡ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ ÎºÎ±Î¹ Ï‡Ï‰ÏÎ¹ÏƒÏ„Î® Ï€ÏÎ¿Ï†Î¿ÏÎ¬ ÎºÎ±Î¹ Ï„Î¿Î½Î¹ÏƒÎ¼ÏŒÏ‚, Î³ÏÎ¬Ï†Î¿Ï…Î¼Îµ Î´Î¹Î±Î»Ï…Ï„Î¹ÎºÎ¬ Î¼Îµ Ï„ÏŒÎ½Î¿ (Ï€.Ï‡. Ï†Î±Î, ÎµÏ…Ï†Ï…ÎÎ±, Î¤Î±Î°Î³ÎµÏ„Î¿Ï‚, ÎºÎ±ÎÎºÎ¹).';

  const bankBlue = [
    { a:'Ï‡Î±ÏŠÎ´ÎµÏÏ‰', b:'Ï‡Î±Î¹Î´ÎµÏÏ‰', correct:'a', rule:ruleBase },
    { a:'Î¸ÎµÏŠÎºÏŒÏ‚', b:'Î¸ÎµÎ¹ÎºÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'Î¼Î±ÏŠÎ¼Î¿Ï', b:'Î¼Î±Î¹Î¼Î¿Ï', correct:'a', rule:ruleBase },
    { a:'Î²Î¿ÏŠÎ´Î¬ÎºÎ¹', b:'Î²Î¿Î¹Î´Î¬ÎºÎ¹', correct:'a', rule:ruleBase },
    { a:'Î¼Ï…ÏŠÎºÏŒÏ‚', b:'Î¼Ï…Î¹ÎºÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'Î¾ÎµÏ‹Ï†Î±Î¯Î½Ï‰', b:'Î¾ÎµÏ…Ï†Î±Î¯Î½Ï‰', correct:'a', rule:ruleBase },
    { a:'Ï€ÏÎ±Ï‹Î½Ï„Î¹ÎºÏŒÏ‚', b:'Ï€ÏÎ±Ï…Î½Ï„Î¹ÎºÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'Ï€ÏÎ¿Ï‹Ï€ÏŒÎ¸ÎµÏƒÎ·', b:'Ï€ÏÎ¿Ï…Ï€ÏŒÎ¸ÎµÏƒÎ·', correct:'a', rule:ruleBase },
    { a:'Î±Ï‹Ï€Î½Î¯Î±', b:'Î±Ï…Ï€Î½Î¯Î±', correct:'a', rule:ruleBase },
    { a:'ÎºÎ¿ÏÎ¿ÏŠÎ´ÎµÏÏ‰', b:'ÎºÎ¿ÏÎ¿Î¹Î´ÎµÏÏ‰', correct:'a', rule:ruleBase },
  ];

  const bankGreen = [
    { a:'Î½ÎµÏÎ¬Î¹Î´Î±', b:'Î½ÎµÏÎ±ÏŠÎ´Î±', correct:'a', rule:ruleTone },
    { a:'Ï€Î»Î¬Î¹', b:'Ï€Î»Î±ÏŠ', correct:'a', rule:ruleTone },
    { a:'ÎºÎ¿ÏÏŒÎ¹Î´ÎµÏˆÎ±', b:'ÎºÎ¿ÏÎ¿ÎÎ´ÎµÏˆÎ±', correct:'a', rule:ruleTone },
    { a:'Î³Î¬Î¹Î´Î±ÏÎ¿Ï‚', b:'Î³Î±ÏŠÎ´Î±ÏÎ¿Ï‚', correct:'a', rule:ruleTone },
    { a:'ÎœÎ¬Î¹Î¿Ï‚', b:'ÎœÎ±ÎÎ¿Ï‚', correct:'a', rule:ruleTone },
    { a:'ÎšÎ¬Î¹ÏÎ¿', b:'ÎšÎ±ÎÏÎ¿', correct:'a', rule:ruleTone },
    { a:'Ï€ÏÏ‰Î¯', b:'Ï€ÏÏ‰Î', correct:'a', rule:ruleNoDiph },
    { a:'Î´Î¹Ï…Î»Î¹ÏƒÏ„Î®ÏÎ¹Î¿', b:'Î´Î¹Ï‹Î»Î¹ÏƒÏ„Î®ÏÎ¹Î¿', correct:'a', rule:ruleNoDiph },
  ];

  const bankGold = [
    { a:'Ï†Î±Î', b:'Ï†Î¬Î¹', correct:'a', rule:ruleBoth },
    { a:'ÎµÏ…Ï†Ï…ÎÎ±', b:'ÎµÏ…Ï†Ï…Î¯Î±', correct:'a', rule:ruleBoth },
    { a:'Î¤Î±Î°Î³ÎµÏ„Î¿Ï‚', b:'Î¤Î±Ï…Î³Î­Ï„Î¿Ï‚', correct:'a', rule:ruleBoth },
    { a:'ÎºÎ±ÎÎºÎ¹', b:'ÎºÎ±Î¹ÎºÎ¯', correct:'a', rule:ruleBoth },
  ];

  const bankRed = [
    { a:'ÎµÏ…Î½Î¿ÏŠÎºÏŒÏ‚', b:'ÎµÏ…Î½Î¿Î¹ÎºÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'ÎºÎ¿ÏÎ¿ÏŠÎ´Î¯Î±', b:'ÎºÎ¿ÏÎ¿Î¹Î´Î¯Î±', correct:'a', rule:ruleBase },
    { a:'Î±Î¸ÎµÏŠÏƒÎ¼ÏŒÏ‚', b:'Î±Î¸ÎµÎ¹ÏƒÎ¼ÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'Ï€ÏÎ¿Ï‹Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚', b:'Ï€ÏÎ¿Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚', correct:'a', rule:ruleBase },
    { a:'ÎµÏ…Ï‹Ï€ÏŒÎ»Î·Ï€Ï„Î¿Ï‚', b:'ÎµÏ…Ï…Ï€ÏŒÎ»Î·Ï€Ï„Î¿Ï‚', correct:'a', rule:ruleBase },
    { a:'Î´Î¹Î±Ï‹Î³Î®Ï‚', b:'Î´Î¹Î±Ï…Î³Î®Ï‚', correct:'a', rule:ruleBase },
  ];

  const remaining = {
    blue: [...bankBlue.keys()],
    green: [...bankGreen.keys()],
    gold: [...bankGold.keys()],
    red: [...bankRed.keys()],
  };
  const pickNextIndex = (kind) => {
    if(!remaining[kind].length){
      remaining[kind] = [...(kind==='blue'?bankBlue:kind==='green'?bankGreen:kind==='gold'?bankGold:bankRed).keys()];
    }
    const i = Math.floor(Math.random() * remaining[kind].length);
    return remaining[kind].splice(i,1)[0];
  };

  const player = { pos: 1 };
  let animating = false;
  let trapTimer = null;
  let feedbackTimer = null;
  let active = null;
  // â±ï¸ Î§ÏÎ¿Î½ÏŒÎ¼ÎµÏ„ÏÎ¿ Ï€Î±ÏÏ„Î¯Î´Î±Ï‚
let gameStartMs = null;
let gameTimer = null;

function fmtTime(ms){
  const total = Math.floor(ms/1000);
  const m = String(Math.floor(total/60)).padStart(2,'0');
  const s = String(total%60).padStart(2,'0');
  return `${m}:${s}`;
}

function startGameTimer(){
  if(gameTimer) return;
  gameStartMs = Date.now();
  gameTimer = setInterval(()=>{
    timeText.textContent = fmtTime(Date.now() - gameStartMs);
  }, 250);
}

function stopGameTimer(){
  if(gameTimer){
    clearInterval(gameTimer);
    gameTimer = null;
  }
}

function resetGameTimer(){
  stopGameTimer();
  gameStartMs = null;
  timeText.textContent = '00:00';
}


  const boardEl = document.getElementById('board');
  const rollBtn = document.getElementById('rollBtn');
  const resetBtn = document.getElementById('resetBtn');
  const diceText = document.getElementById('diceText');
  const posText = document.getElementById('posText');
  const logEl = document.getElementById('log');
  const timeText = document.getElementById('timeText');

  const overlay = document.getElementById('overlay');
  const modalTitle = document.getElementById('modalTitle');
  const modalDesc = document.getElementById('modalDesc');
  const questionText = document.getElementById('questionText');
  const choicesEl = document.getElementById('choices');
  const rulebox = document.getElementById('rulebox');
  const timerWrap = document.getElementById('timerWrap');
  const timerNum = document.getElementById('timerNum');

  const cells = new Map();
  boardEl.innerHTML = '';
  for(let i=1;i<=N;i++){
    const d = document.createElement('div');
    d.className = 'cell';
    d.textContent = i;
    if(BLUE.has(i)) d.classList.add('blue');
    if(GREEN.has(i)) d.classList.add('green');
    if(GOLD.has(i)) d.classList.add('gold');
    if(RED.has(i)) d.classList.add('red');
    boardEl.appendChild(d);
    cells.set(i,d);
  }

  function renderPawn(){
    for(const [,cell] of cells){
      cell.querySelectorAll('.pawn').forEach(p=>p.remove());
    }
    const cell = cells.get(player.pos);
    if(cell){
      const pawn = document.createElement('div');
      pawn.className = 'pawn';
      cell.appendChild(pawn);
    }
    posText.textContent = String(player.pos);
  }

  function log(msg){
    const p = document.createElement('p');
    p.textContent = msg;
    logEl.appendChild(p);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function clampPos(x){ return Math.min(N, Math.max(1, x)); }
  const sleep = (ms) => new Promise(r=>setTimeout(r,ms));

  function stopTrapTimer(){ if(trapTimer){ clearInterval(trapTimer); trapTimer=null; } }
  function stopFeedbackTimer(){ if(feedbackTimer){ clearTimeout(feedbackTimer); feedbackTimer=null; } }

  async function moveBy(steps, triggerChallenge = true){
    animating = true;
    rollBtn.disabled = true;

    const target = clampPos(player.pos + steps);
    const dir = target >= player.pos ? 1 : -1;

    while(player.pos !== target){
      player.pos += dir;
      renderPawn();
      await sleep(120);
    }

    animating = false;
    rollBtn.disabled = false;

    if(player.pos === N){
  stopGameTimer();
  log('ğŸ Î¤Î­Î»Î¿Ï‚! ÎˆÏ†Ï„Î±ÏƒÎµÏ‚ ÏƒÏ„Î¿ 100!');
  log(`â±ï¸ Î§ÏÏŒÎ½Î¿Ï‚ Ï€Î±ÏÏ„Î¯Î´Î±Ï‚: ${timeText.textContent}`);
  rollBtn.disabled = true;
  return;
}

    if(!triggerChallenge) return;

    if(BLUE.has(player.pos)) return openChallenge('blue');
    if(GREEN.has(player.pos)) return openChallenge('green');
    if(GOLD.has(player.pos)) return openChallenge('gold');
    if(RED.has(player.pos)) return openChallenge('red');
  }

  function getItem(kind){
    if(kind==='blue')  return bankBlue[pickNextIndex('blue')];
    if(kind==='green') return bankGreen[pickNextIndex('green')];
    if(kind==='gold')  return bankGold[pickNextIndex('gold')];
    return bankRed[pickNextIndex('red')];
  }

  function openChallenge(kind){
    stopTrapTimer();
    stopFeedbackTimer();

    const item = getItem(kind);
    active = { kind, item, answered:false };

    rulebox.classList.remove('show');
    rulebox.innerHTML = '';
    timerWrap.style.display = (kind==='red') ? 'block' : 'none';

    modalTitle.textContent =
      kind==='blue'  ? 'ğŸŸ¦ Î•Ï€Î¯Ï€ÎµÎ´Î¿ 1: Î•ÏÎºÎ¿Î»Î¿' :
      kind==='green' ? 'ğŸŸ© Î•Ï€Î¯Ï€ÎµÎ´Î¿ 2: ÎœÎµÏƒÎ±Î¯Î¿' :
      kind==='gold'  ? 'ğŸŸ¨ Boss Level' :
      'ğŸŸ¥ Î¤ÎµÎ»Î¹ÎºÏŒ Î•Ï€Î¯Ï€ÎµÎ´Î¿ (5â€™â€™)';

    modalDesc.textContent =
      kind==='blue'  ? 'Î£Ï‰ÏƒÏ„ÏŒ: +1' :
      kind==='green' ? 'Î£Ï‰ÏƒÏ„ÏŒ: +2' :
      kind==='gold'  ? 'Î£Ï‰ÏƒÏ„ÏŒ: +3' :
      'Î£Ï‰ÏƒÏ„ÏŒ: +4 | Î›Î¬Î¸Î¿Ï‚/Timeout: âˆ’3';

    questionText.textContent = 'Î”Î¹Î¬Î»ÎµÎ¾Îµ Ï„Î· ÏƒÏ‰ÏƒÏ„Î® Î³ÏÎ±Ï†Î®:';

    choicesEl.innerHTML = '';
    const btnA = document.createElement('button');
    btnA.className = 'choice';
    btnA.type = 'button';
    btnA.textContent = item.a;
    btnA.onclick = () => submitAnswer('a');

    const btnB = document.createElement('button');
    btnB.className = 'choice';
    btnB.type = 'button';
    btnB.textContent = item.b;
    btnB.onclick = () => submitAnswer('b');

    choicesEl.appendChild(btnA);
    choicesEl.appendChild(btnB);

    overlay.classList.add('show');

    if(kind==='red') startRedTimer(TRAP_SECONDS);
  }

  function startRedTimer(seconds){
    stopTrapTimer();
    let remainingSec = seconds;
    timerNum.textContent = String(remainingSec);

    trapTimer = setInterval(()=>{
      remainingSec -= 1;
      timerNum.textContent = String(remainingSec);
      if(remainingSec <= 0){
        stopTrapTimer();
        if(active && !active.answered){
          active.answered = true;
          lockChoices();
          showFeedback(false, true);
          scheduleResolution(false, true);
        }
      }
    }, 1000);
  }

  function lockChoices(){
    Array.from(choicesEl.querySelectorAll('button')).forEach(b=>b.disabled=true);
  }

  function showFeedback(correct, timeout=false){
    const { item } = active;
    rulebox.classList.add('show');
    rulebox.innerHTML = `
      <div style="font-weight:900;margin-bottom:6px;">
        ${timeout ? 'â±ï¸ Î Î¿Î»Ï Î±ÏÎ³Î¬!' : (correct ? 'âœ… Î£Ï‰ÏƒÏ„ÏŒ!' : 'âŒ Î›Î¬Î¸Î¿Ï‚!')}
      </div>
      <div style="font-weight:900;margin-bottom:6px;">ÎšÎ±Î½ÏŒÎ½Î±Ï‚:</div>
      <div>${item.rule}</div>
    `;
  }

  function scheduleResolution(correct, timeout=false){
    stopFeedbackTimer();
    feedbackTimer = setTimeout(async () => {
      overlay.classList.remove('show');

      const kind = active.kind;

      if(kind==='blue' && correct){ log('âœ… ğŸŸ¦ +1'); await moveBy(+1, false); return; }
      if(kind==='green' && correct){ log('âœ… ğŸŸ© +2'); await moveBy(+2, false); return; }
      if(kind==='gold' && correct){ log('âœ… ğŸŸ¨ +3'); await moveBy(+3, false); return; }

      if(kind==='red'){
        if(correct){ log('âœ… ğŸŸ¥ +4'); await moveBy(+4, false); return; }
        log(timeout ? 'â±ï¸ ğŸŸ¥ âˆ’3' : 'âŒ ğŸŸ¥ âˆ’3');
        await moveBy(-3, false);
        return;
      }

      log('âŒ 0');
    }, FEEDBACK_MS);
  }

  function submitAnswer(choice){
    if(!active || active.answered) return;

    active.answered = true;
    stopTrapTimer();
    lockChoices();

    const correct = (choice === active.item.correct);
    showFeedback(correct, false);
    scheduleResolution(correct, false);
  }

 rollBtn.onclick = async () => {
  if(animating) return;
  if(overlay.classList.contains('show')) return;

  startGameTimer();

  const roll = 1 + Math.floor(Math.random()*6);
  diceText.textContent = String(roll);
  log(`ğŸ² ÎˆÏÎ¹Î¾ÎµÏ‚: ${roll}`);
  await moveBy(roll, true);
};


 resetBtn.onclick = () => {
  resetGameTimer();

  stopTrapTimer();
  stopFeedbackTimer();
  overlay.classList.remove('show');

  rollBtn.disabled = false;
  diceText.textContent = 'â€”';
  logEl.innerHTML = '';

  remaining.blue = [...bankBlue.keys()];
  remaining.green = [...bankGreen.keys()];
  remaining.gold = [...bankGold.keys()];
  remaining.red = [...bankRed.keys()];

  player.pos = 1;
  renderPawn();
  log('ğŸ”„ ÎÎ­Î± Ï€Î±ÏÏ„Î¯Î´Î±!');
};

  };

  renderPawn();
  log('ğŸ® ÎˆÏ„Î¿Î¹Î¼Î¿! Î Î¬Ï„Î± "Î¡Î¯Î¾Îµ Ï„Î¿ Î¶Î¬ÏÎ¹".');
});
</script>

</body>
</html>
